# 量化交易系统 (Quantitative Trading System)

本项目是一个专注于中国市场行业ETF的量化交易系统，基于趋势识别、行业轮动和风险控制构建的自动化交易框架。

## 系统概述

本系统旨在通过技术分析和行业轮动策略，在中国ETF市场中捕捉行业轮动机会，实现超额收益。系统通过多维度的技术指标和行业强弱对比，优先选择强势行业的ETF进行交易，同时配备了严格的风险控制机制。

## 目标

- 构建一个完整的ETF行业轮动量化交易系统
- 实现自动化的数据获取、信号生成和交易执行流程
- 通过回测验证策略在不同市场环境下的表现
- 建立实时交易系统与预警机制

## 系统架构设计

### 1. 数据模块
- [ ] 接入行业ETF历史数据（日线/分钟线）
- [ ] 获取大盘指数数据（沪深300/中证500等）
- [ ] 集成实时行情API（用于14:50前最后信号确认）

### 2. 策略模块
- [ ] 趋势识别（均线系统/MACD/布林带）
- [ ] 动量指标计算（RSI/ATR波动率）
- [ ] 行业强弱对比系统

### 3. 交易逻辑
- [ ] 趋势策略
  - [ ] 买入信号：突破关键趋势线+行业强度前3
  - [ ] 卖出信号：跌破动态止损线/趋势反转
- [ ] 波段策略
  - [ ] 买入信号：超卖区域反弹+成交量确认
  - [ ] 卖出信号：超买区域回落+背离确认
- [ ] 策略融合机制
  - [ ] 趋势与波段信号协同确认
  - [ ] 市场环境自适应切换
- [ ] 仓位控制模型（凯利公式改进版）

### 4. 风控模块
- [ ] 动态止损机制（追踪式/波动率自适应）
- [ ] 单日最大亏损熔断
- [ ] 行业分散度控制（不超过3个行业）

## 实施路线图

### 第一阶段：基础建设（1-2周）
- [x] 选择数据源（Tushare Pro/聚宽）
  - [x] 获取行业ETF清单
  - [x] 申请API密钥
  - [x] 测试API连接
- [x] 搭建Python数据管道
  - [x] 历史数据下载模块
  - [x] 实时数据订阅模块
  - [x] 数据清洗与规范化
- [x] 构建基础回测框架
  - [x] 选择/自建回测引擎（Backtrader/向量化回测）
  - [x] 实现交易记录与绩效统计模块
  - [x] 回测可视化功能

### 第二阶段：策略开发（2-3周）
- [x] 趋势策略开发
  - [x] 布林带（Bollinger Bands）突破信号识别
  - [x] MACD长短周期移动平均线收敛与发散（1个月期与200日EMA）
  - [x] 多维周期组合策略（5分钟/15分钟/60分钟）
  - [x] 对冲型反转策略（基于144日EMA均线通道的突破交易）
  - [x] 量价齐升确认（成交量>5日均量*1.2）
  - [x] K线收盘价交易执行（减少滑点冲击）
- [ ] 波段策略开发
  - [ ] RSI/KDJ超买超卖区域识别
  - [ ] 布林带通道突破与回归
  - [ ] 价格形态识别（双底/头肩底等）
- [ ] 策略融合机制
  - [ ] 以趋势跟踪为主（60-80%仓位），多周期策略优化入场（20-30%），反转策略作为风险对冲（5-10%）。
  - [ ] 趋势与波段信号权重分配
  - [ ] 市场环境分类（震荡/单边/剧烈波动）
  - [ ] 自适应策略切换阈值设定
- [ ] 行业轮动模型
  - [ ] 计算各行业ETF的5日收益率排名
  - [ ] 结合行业资金流向数据（L2数据优先）
  - [ ] 行业景气度评分系统
- [ ] 止损系统
  - [ ] 初始止损：入场价-2倍ATR
  - [ ] 盈利保护：最高点回撤3%平仓
  - [ ] 波动率自适应止损调整
  - [ ] 策略失效标准评估（核心逻辑崩溃而非短期回撤）
  - [ ] 因子优化（主力资金流入天数统计、突破新高判定等）

### 第三阶段：回测优化（1周）
- [ ] 测试周期选择
  - [ ] 包含牛熊周期（2018-2024）
  - [ ] 不同市场环境下的表现分析
  - [ ] 指数基准对比（如沪深300）
- [ ] 关键参数敏感性分析
  - [ ] 持仓周期（1-5日测试）
  - [ ] 仓位权重（30%-70%动态调整）
  - [ ] 止损参数优化
- [ ] 极端行情压力测试
  - [ ] 2015股灾场景模拟
  - [ ] 2020疫情行情回测
  - [ ] 流动性风险评估

### 第四阶段：实盘对接（1周）
- [ ] 开发定时任务
  - [ ] 每天14:30启动策略计算
  - [ ] 数据更新与信号生成流程
  - [ ] 任务状态监控
- [ ] 构建信号输出模块
  - [ ] CSV结构化输出
  - [ ] 微信API通知集成
  - [ ] 信号详情与解释
- [ ] 开发异常监控
  - [ ] 网络中断检测
  - [ ] 数据异常报警
  - [ ] 系统恢复机制

## 技术栈选择

- **编程语言**: Python
- **数据源**: AKshare
- **回测框架**: Backtrader/自建向量化回测
- **数据存储**: CSV/SQLite/MySQL
- **可视化**: Matplotlib/Plotly
- **通知系统**: 企业微信API/邮件

## 项目结构

```
PersonalQuant/
├── data/                 # 数据存储
│   ├── raw/              # 原始数据
│   └── processed/        # 处理后的数据
├── src/                  # 源代码
│   ├── data/             # 数据获取与处理
│   ├── features/         # 特征工程
│   ├── models/           # 策略模型
│   ├── backtesting/      # 回测框架
│   └── trading/          # 交易执行
├── notebooks/            # Jupyter笔记本
├── tests/                # 测试代码
├── config/               # 配置文件
└── docs/                 # 文档
```

## 开发进度跟踪

- [ ] 第一阶段: 基础建设 (计划完成日期: _________)
- [ ] 第二阶段: 策略开发 (计划完成日期: _________)
- [ ] 第三阶段: 回测优化 (计划完成日期: _________)
- [ ] 第四阶段: 实盘对接 (计划完成日期: _________)

## 注意事项

- 确保数据质量和完整性
- 关注回测与实盘结果的差异
- 考虑交易成本和滑点因素
- 定期进行策略评估和调整
- 控制单日最大亏损和总风险敞口

## 资源链接

- [Tushare API文档](https://tushare.pro/document/2)
- [Backtrader文档](https://www.backtrader.com/docu/)
- [聚宽量化平台](https://www.joinquant.com/)
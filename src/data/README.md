# 数据模块 (Data Module)

本模块负责获取、处理和管理量化交易系统所需的各类市场数据。数据是量化交易系统的基础，高质量的数据对策略的有效性至关重要。

## 数据需求概述

本系统需要以下几类核心数据，用于行业ETF轮动策略的实现：

## 一、核心数据需求

### 1. 基础行情数据（日频更新）

| 数据项 | 说明 | 用途 |
|-------|------|------|
| 开盘价、最高价、最低价、收盘价、当前最新价 | OHLC价格数据 | 计算K线形态和趋势指标（均线、MACD等） |
| 成交量、成交额 | 交易活跃度指标 | 判断市场活跃度和资金动向 |
| 换手率 | 流通股换手情况 | 辅助判断筹码集中度或短期热度 |

### 2. 技术指标数据（可自行计算）

| 指标类型 | 具体指标 | 用途 |
|---------|---------|------|
| 趋势类指标 | MA5/MA20/MA60（均线）、MACD、布林带 | 判断价格趋势方向和强度 |
| 波段类指标 | RSI（相对强弱指数）、KDJ（随机指标）、CCI（顺势指标） | 判断超买超卖状态和可能的反转点 |
| 量价指标 | OBV（能量潮）、成交量均线 | 验证价格趋势的有效性 |

### 3. 财务数据（季频/年频更新）

| 数据项 | 说明 | 用途 |
|-------|------|------|
| 基本面指标 | 市盈率（PE）、市净率（PB）、ROE（净资产收益率）、净利润增长率 | 评估行业基本面状况 |
| 行业排名 | 股票在所属行业中的财务表现排名 | 筛选优质标的，识别行业龙头 |

### 4. 资金流向数据

| 数据项 | 说明 | 用途 |
|-------|------|------|
| 主力资金净流入/流出 | 大单资金动向 | 识别机构投资者行为 |
| 北向资金持仓 | 外资持仓变化 | 了解外资偏好，预判市场走势 |

### 5. 市场情绪数据

| 数据项 | 说明 | 用途 |
|-------|------|------|
| 融资融券余额 | 杠杆交易数据 | 反映市场杠杆情绪，预警过热或过冷 |
| 涨停板/跌停板数量 | 极端行情统计 | 判断市场极端情绪，识别市场拐点 |

### 6. 板块与指数数据

| 数据项 | 说明 | 用途 |
|-------|------|------|
| 行业板块涨跌幅 | 各行业ETF表现 | 判断热点轮动，识别强势行业 |
| 大盘指数数据 | 上证指数、深成指、创业板指等 | 系统性风险控制，市场整体趋势判断 |

## 二、数据处理流程

### 1. 数据获取

- **数据源选择**：优先使用Tushare Pro或聚宽数据，作为主要数据提供商
- **备选数据源**：东方财富、同花顺、Wind（如有条件）
- **获取频率**：
  - 日线数据：每个交易日收盘后更新
  - 分钟线数据：实时获取（用于14:50前最后信号确认）
  - 财务数据：季报发布后更新

### 2. 数据清洗

- 缺失值处理：对于缺失的价格数据，使用前值填充或插值法处理
- 异常值检测：识别并处理价格、成交量中的异常值
- 数据标准化：将不同数据源的数据格式统一化处理

### 3. 数据存储

- **原始数据**：存储在`data/raw`目录，保持原始格式
- **处理后数据**：存储在`data/processed`目录，按标准格式组织
- **存储格式**：
  - CSV文件：适用于小型数据集和快速访问
  - SQLite/MySQL：适用于大型数据集和复杂查询

### 4. 数据更新机制

- **增量更新**：只获取新增数据，减少网络和存储开销
- **定时任务**：设置每日自动更新任务，确保数据时效性
- **数据验证**：更新后进行数据完整性和一致性检查

## 三、数据模块接口

数据模块将提供以下核心接口，供策略和回测模块调用：

```python
# 获取ETF历史数据
get_etf_history(code, start_date, end_date, fields=['open', 'high', 'low', 'close', 'volume'])

# 获取行业ETF列表
get_industry_etfs()

# 获取技术指标
get_technical_indicators(code, indicator_name, params={})

# 获取行业资金流向
get_industry_fund_flow(industry_code, date)

# 获取市场情绪指标
get_market_sentiment(date)
```

## 四、数据质量保障

- **数据源对比**：定期对比不同数据源，确保数据准确性
- **前复权处理**：对价格数据进行前复权，消除分红送股影响
- **数据回填**：对历史数据进行完整性检查，确保无缺失
- **异常监控**：设置数据异常预警机制，及时发现并处理问题

## 五、注意事项

- 确保API密钥有效，并遵守数据提供商的使用条款
- 注意控制API调用频率，避免触发限流
- 对于付费数据，优先使用缓存和本地存储，减少不必要的API调用
- 保持数据的时间一致性，特别是在使用多个数据源时
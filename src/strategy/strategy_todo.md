# 量化交易策略实现 Todo List

核心工作流：逐个板块检查龙头股、板块涨幅、资金流入等 确定行业，根据行业选择ETF，然后决定买点、卖点

## 1. 数据获取与预处理模块

- [x] 在 etf_list 表中新建 etf_industry 字段，用于存储 ETF 所属行业（是否需要和 industry_fund_flow ）

- [x] **创建行业以及 ETF 指数数据获取功能**
    - [x] 获取行业板块数据
    - [] 获取概念板块数据
    - [x] 获取 ETF 指数数据
- [x] **开发ETF-行业板块关联数据管理功能**
    - [x] 记录ETF代码与所属行业板块ID的关联：调用 fund_portfolio_hold_em 获取 ETF 持仓前十，并调用 stock_individual_info_em 获取持仓个股的行业，取行业最多的作为ETF所属行业，写入 etf_list 表
- [] **测试数据获取功能**


## 2. 强势题材识别模块 (宏观与中观层面)
- [ ] **实现题材热度监测功能**
    - [ ] **龙头效应识别**：监测市场是否存在3连板及以上，并能带动板块效应的龙头股
    - [ ] **板块涨幅与资金流入分析**：
        - [ ] 计算过去N日（如3日、5日）特定行业板块指数的涨幅，并进行排序
        - [ ] 监测板块资金净流入情况 (基于获取的资金流向数据)
    - [ ] **板块内涨停家数与梯队效应分析**：
        - [ ] 统计板块内每日涨停股票数量
        - [ ] 分析涨停股票是否形成梯队效应 (龙头、助攻、跟风)
    - [ ] **成交额占比分析**：计算强势题材成交额占市场总成交额的比例
- [ ] **实现题材持续性评估算法**
    - [ ] 分析题材是否具有较强的逻辑支撑 (如业绩预期、技术突破、产业趋势)
    - [ ] 评估市场主流研报对题材的覆盖度和看好程度
    - [ ] 识别并排除纯粹由短线情绪推动、缺乏基本面逻辑的题材 (超短线策略除外)


## 3. 趋势确认模块 (技术面核心)
- [ ] **开发均线系统分析功能**
    - [ ] 计算MA5, MA10, MA20, MA60等常用均线
    - [ ] **多头排列判断**：股价站上MA20、MA60；且MA5 > MA10 > MA20 > MA60 (或至少MA20 > MA60)
    - [ ] **关键均线支撑判断**：股价运行在重要的中长期均线上方 (如MA20, MA60)
- [ ] **实现MACD指标分析功能**
    - [ ] 计算DIF, DEA, MACD柱线
    - [ ] 判断DIF线与DEA线是否均在0轴上方运行
    - [ ] 判断近期是否发生金叉，或金叉后红柱是否持续
- [ ] **开发价格形态识别功能**
    - [ ] **上升通道识别**：判断股价是否处于上升通道中
    - [ ] **突破形态识别**：判断股价是否已突破前期重要压力平台/箱体上沿
    - [ ] **头部形态排除**：识别并排除明显的头部形态 (如M头、头肩顶)
- [ ] **实现成交量配合分析功能**
    - [ ] 判断上涨阶段成交量是否温和放大或保持活跃
    - [ ] 判断突破关键位置时是否有明显放量
- [ ] **构建趋势评分系统**
    - [ ] 根据均线系统、MACD、价格形态、成交量等因素综合打分

## 4. 回踩买点识别模块 (精准择时)
- [ ] **开发回踩目标支撑位识别功能**
    - [ ] **均线支撑识别**：MA10, MA20 (常用强弱分界和回踩支撑), MA60 (趋势较强个股的深踩支撑)
    - [ ] **前期平台/突破颈线位支撑识别**：股价回调至前期震荡平台的上沿或突破颈线位附近
    - [ ] **布林带支撑识别** (可选)：股价回调至布林带中轨或下轨 (通常表明回调较深或趋势转弱)
- [ ] **实现回踩确认信号识别功能**
    - [ ] **缩量判断**：回调过程中成交量是否明显萎缩
- [ ] **开发K线形态识别功能 (在支撑位附近)**
    - [ ] 识别**锤子线**
    - [ ] 识别**十字星**
    - [ ] 识别**早晨之星**
    - [ ] 识别**阳线反包阴线**等企稳K线形态
- [ ] **开发RSI指标分析功能**
    - [ ] 计算RSI指标值
    - [ ] 判断RSI是否从高位回落至50附近 (强势回调) 或从超卖区 (如30-40) 拐头向上
    - [ ] 避免在RSI持续钝化于超买区时介入回调
- [ ] **实现MFI资金流向分析功能 (可选)**
    - [ ] 计算MFI指标值
    - [ ] 判断MFI是否在回调至低位后开始回升，或在企稳时出现资金流入迹象
- [ ] **(可选) 次日成交量再放大确认**
    - [ ] 监测企稳后次日股价上涨且成交量是否重新温和放大
- [ ] **构建回踩信号质量评分系统**
    - [ ] 根据缩量程度、K线形态、RSI/MFI指标配合等因素综合打分

## 5. 综合评分与决策模块
- [ ] **开发题材强度评分算法**
    - [ ] 基于题材的热度、持续性、政策支持等因素进行评分
- [ ] **实现趋势强度评分算法**
    - [ ] 基于均线排列、MACD状态、价格形态等因素进行评分
- [ ] **开发回踩信号质量评分算法**
    - [ ] 基于缩量程度、K线形态、指标配合等因素进行评分
- [ ] **实现综合评分与股票排名功能**
    - [ ] 结合题材强度、趋势强度、回踩信号质量评分，计算综合得分并对股票进行排名
- [ ] **开发ETF评分数据记录功能**
    - [ ] 存储每日各ETF的题材强度评分、趋势强度评分、回踩信号质量评分、综合评分
- [ ] **开发最终选股决策算法**
    - [ ] 优先选择“强势题材 + 强趋势 + 高质量回踩信号”的组合
    - [ ] 设置评分阈值进行筛选

## 6. 买入与资金管理模块
- [ ] **实现买入时机判断功能**
    - [ ] 当“回踩确认信号”出现时，触发买入逻辑
    - [ ] **低吸型买点判断**：缩量回踩至MA20/MA60等关键支撑位，出现企稳K线后，次日开盘或盘中择机买入
- [ ] **开发初始仓位计算功能**
    - [ ] **固定分批仓位策略**：例如，首次建仓不超过总资金的X% (如10%) 或单只股票不超过组合的Y% (如20%)
- [ ] **实现加仓条件判断功能**
    - [ ] 若买入后股价按预期上涨并突破近期小平台，可在小幅回踩不破时考虑加仓
    - [ ] 总仓位不超过总资金的Z% (如20%) 或单只股票不超过组合的W% (如30%)
- [ ] **开发资金分配与持仓管理功能**
    - [ ] 限制同时持股数量 (如3-5只)，避免过度集中

## 7. 止盈止损模块
- [ ] **实现技术止损功能**
    - [ ] **关键支撑均线止损**：跌破买入时所依赖的关键支撑均线 (如回踩MA20买入，则MA20被有效跌破)
    - [ ] **回踩K线形态低点止损**：跌破回踩企稳K线形态的最低点
    - [ ] **上升趋势结构破坏止损**：MA均线出现死叉，或跌破重要上升趋势线
- [ ] **开发百分比止损功能**
    - [ ] 从买入价计算，亏损达到X% (如7%-10%) 无条件止损
- [ ] **实现时间止损功能 (可选)**
    - [ ] 买入后N个交易日 (如3-5天) 股价毫无表现或持续阴跌，即使未到止损位，也考虑减仓或出局
- [ ] **开发趋势衰竭信号识别功能 (用于止盈)**
    - [ ] **短期均线跌破**：股价跌破短期重要均线 (如MA5, MA10)，且无法快速收回
    - [ ] **MACD顶背离与死叉**：MACD出现顶背离后发生死叉
    - [ ] **量价异常**：放出巨量但滞涨，或出现长上影线、乌云盖顶等看跌K线组合
    - [ ] **RSI超买回落**：RSI进入超买区 (如>80) 后掉头向下
- [ ] **实现目标止盈功能**
    - [ ] 达到预设盈利目标 (如20%-30%) 后，可分批止盈或结合移动止盈
- [ ] **开发移动止盈功能**
    - [ ] **均线移动止盈**：以MA10或MA20作为移动止盈线，跌破则止盈
    - [ ] **回撤止盈**：从阶段性高点回落X% (如10%) 止盈
- [ ] **实现题材退潮信号识别功能 (用于止盈)**
    - [ ] 监测所持股票所属的强势题材是否出现整体退潮迹象 (龙头股大幅杀跌、板块内多只个股跌停、资金持续流出)

## 8. 回测与优化模块
- [ ] **开发历史数据回测框架**
    - [ ] 支持使用过去N年 (如3-5年) 的历史数据进行回测
- [ ] **实现策略性能评估功能**
    - [ ] 计算并展示关键性能指标：夏普比率、最大回撤、年化收益率、胜率、平均盈亏比、单次最大盈利/亏损等
- [ ] **开发参数优化功能**
    - [ ] **可优化参数列表**：均线周期 (MA10, MA20, MA60等)、RSI阈值、成交量萎缩比例、止盈止损百分比等
    - [ ] 实现参数遍历或智能优化算法
    - [ ] **注意避免过度拟合**：使用样本外数据进行验证
- [ ] **实现因子权重调整功能**
    - [ ] 允许根据市场不同阶段 (牛市、熊市、震荡市) 调整题材、趋势、回踩信号等因子的权重
- [ ] **开发策略表现定期审视功能**
    - [ ] 支持至少每季度或每半年回顾策略表现，并根据市场环境变化进行调整的机制

## 9. 系统集成与可视化
- [ ] 开发策略运行主流程调度器
- [ ] 实现选股结果、交易信号的实时监控与通知功能 (邮件、APP推送等)
- [ ] 开发交易信号可视化界面 (如K线图标记买卖点)
- [ ] 实现策略表现报告自动生成与可视化展示 (收益曲线、关键指标变化等)
- [ ] 开发用户参数配置界面，方便调整策略参数和开关

## 10. 测试与部署
- [ ] 编写各模块单元测试，确保功能正确性
- [ ] 进行完整的集成测试，验证策略流程
- [ ] 开发模拟交易环境，对接模拟盘进行测试
- [ ] 实现与实盘交易接口的对接 (若用于实盘)
- [ ] 部署运行监控、日志记录与报警系统
